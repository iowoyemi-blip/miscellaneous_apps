
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Target Score Challenge — Rules of Exponents</title>
<style>
  :root{ --bg:#0f172a; --card:#111827; --ink:#e5e7eb; --muted:#9ca3af; --accent:#7c3aed; --good:#16a34a; --bad:#dc2626; --warn:#f59e0b; }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(135deg,#0b1226,#0e1630 40%,#0d1b2a);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:900px;margin:auto;padding:24px}
  .card{background:rgba(17,24,39,.85);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:24px;box-shadow:0 10px 25px rgba(0,0,0,.35)}
  h1{font-size:clamp(24px,3.2vw,34px);margin:0 0 8px}
  .sub{color:var(--muted);margin:0 0 18px}
  .row{display:flex;gap:16px;flex-wrap:wrap;align-items:center}
  input{background:#0b1020;color:var(--ink);border:1px solid rgba(255,255,255,.1);border-radius:10px;padding:12px;font-size:16px;outline:none}
  .btn{cursor:pointer;border:0;border-radius:12px;padding:12px 18px;font-weight:700;letter-spacing:.3px}
  .btn.primary{background:var(--accent);color:white}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.2);color:var(--ink)}
  .hud{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:8px 0 10px;flex-wrap:wrap}
  .pill{font-weight:800;padding:6px 10px;border-radius:999px;background:#0b1020;border:1px solid rgba(255,255,255,.12);color:var(--muted)}
  .timer{height:10px;background:#0a1022;border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,.08)}
  .bar{height:100%;width:100%;background:linear-gradient(90deg,#22c55e,#f59e0b,#ef4444);transition:width .2s linear}
  .math{font-size:clamp(18px,2.6vw,28px);font-weight:800;text-align:center;margin:12px 0}
  .grid{display:grid;grid-template-columns:repeat(2,minmax(220px,1fr));gap:12px;margin-top:10px}
  .choice{display:flex;align-items:center;justify-content:center;text-align:center;background:#0c1328;border:1px solid rgba(255,255,255,.08);color:var(--ink);border-radius:14px;min-height:72px;padding:12px;font-weight:700;cursor:pointer;transition:.15s transform,.15s box-shadow,.15s background}
  .choice:hover{transform:translateY(-2px);box-shadow:0 10px 15px rgba(0,0,0,.25)}
  .choice.correct{background:rgba(22,163,74,.18);border-color:rgba(22,163,74,.45)}
  .choice.wrong{background:rgba(220,38,38,.18);border-color:rgba(220,38,38,.45)}
  .footer{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
  sup{font-size:.6em}
  .note{font-size:13px;color:var(--muted);margin-top:10px}
  .target{font-weight:900}
</style>
</head>
<body>
<div class="wrap">
  <div id="screen-start" class="card">
    <h1>Target Score Challenge — Rules of Exponents</h1>
    <p class="sub">Goal: reach <span class="target">5,000 pts</span> in <b>3:00</b>. Instant feedback, streak bonuses, and time bonuses.</p>
    <div class="row">
      <label>Player name
        <input id="player" placeholder="e.g., Jordan A." autocomplete="off">
      </label>
      <div class="pill">Settings locked</div>
    </div>
    <div class="note">Scoring: Correct = 200 pts + time bonus (up to 300) + streak bonus (50 per streak, max 300). Wrong = no points, streak resets.</div>
    <div style="margin-top:18px;display:flex;gap:10px;flex-wrap:wrap">
      <button class="btn primary" id="start">Start Challenge</button>
    </div>
  </div>

  <div id="screen-game" class="card" style="display:none">
    <div class="hud">
      <div class="pill">Target: <span id="target">5000</span></div>
      <div class="pill">Score: <span id="score">0</span></div>
      <div class="pill">Streak: <span id="streak">0</span></div>
      <div class="pill">Time: <span id="clock">3:00</span></div>
    </div>
    <div class="timer"><div class="bar" id="bar" style="width:100%"></div></div>
    <div class="math" id="prompt">…</div>
    <div class="grid" id="choices"></div>
    <div class="footer">
      <button class="btn ghost" id="skip">Skip</button>
      <button class="btn primary" id="next" disabled>Next</button>
    </div>
  </div>

  <div id="screen-done" class="card" style="display:none">
    <h1 id="resultTitle">Challenge Over</h1>
    <p class="sub" id="resultSub"></p>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
      <button class="btn primary" id="again">Play Again</button>
      <button class="btn ghost" id="csv">Export CSV</button>
      <button class="btn ghost" id="json">Export JSON</button>
    </div>
    <div class="note" id="summary"></div>
  </div>
</div>

<script>
(function(){
  const BANK = [{"prompt": "(-2)^5", "correct": "-32", "choices": ["(-2)^5", "32", "-64"]}, {"prompt": "-3^4", "correct": "-81", "choices": ["81", "-3^4", "-162"]}, {"prompt": "(-1)^15", "correct": "-1", "choices": ["1", "(-1)^15", "-2"]}, {"prompt": "y^8 · y^6", "correct": "y^14", "choices": ["y^13", "y^8 · y^6", "-y^14"]}, {"prompt": "-2x^3 · 4x^5", "correct": "-8x^8", "choices": ["8x^8", "-16x^8", "-8x^7"]}, {"prompt": "-2y^5x^3 · 3y^3x^5", "correct": "-6x^8y^8", "choices": ["-2y^5x^3 · 3y^3x^5", "-12x^8y^8", "-6x^7y^8"]}, {"prompt": "(4x^3y^8)(3x^7y^3)", "correct": "12x^10y^11", "choices": ["12x^9y^11", "-12x^10y^11", "24x^10y^11"]}, {"prompt": "(x^3y^4)^2 · (3x^7y^3)", "correct": "3x^13y^11", "choices": ["-3x^13y^11", "(x^3y^4)^2 · (3x^7y^3)", "3x^12y^11"]}, {"prompt": "(9x^20)/(3x^12)", "correct": "3x^8", "choices": ["6x^8", "3x^7", "(9x^20)/(3x^12)"]}, {"prompt": "(14x^3)/(28x^8)", "correct": "1/(2x^5)", "choices": ["1/(2x^4)", "2/(2x^5)", "(14x^3)/(28x^8)"]}, {"prompt": "7p^3/(-21p^9)", "correct": "-1/(3p^6)", "choices": ["7p^3/(-21p^9)", "1/(3p^6)", "-1/(3p^5)"]}, {"prompt": "(-25x^2y^12)/(-10x^7y^5)", "correct": "5y^7/(2x^5)", "choices": ["(-25x^2y^12)/(-10x^7y^5)", "-5y^7/(2x^5)", "10y^7/(2x^5)"]}, {"prompt": "(-2x^5)^4", "correct": "16x^20", "choices": ["(-2x^5)^4", "-16x^20", "32x^20"]}, {"prompt": "(x^4y^3 · x^2y)^2", "correct": "x^12y^8", "choices": ["(x^4y^3 · x^2y)^2", "-x^12y^8", "2x^12y^8"]}, {"prompt": "(3x^4y^8)^3", "correct": "27x^12y^24", "choices": ["27x^11y^24", "-27x^12y^24", "54x^12y^24"]}, {"prompt": "((-27x^5y · xy^2)/((3x^2y^6)^2))^3", "correct": "-27x^6/(y^27)", "choices": ["((-27x^5y · xy^2)/((3x^2y^6)^2))^3", "27x^6/(y^27)", "-54x^6/(y^27)"]}];
  const TARGET = 5000;
  const TOTAL_SECS = 180;

  const $ = s=>document.querySelector(s);
  const shuffle = arr => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);

  const S = {
    start: $("#screen-start"),
    game:  $("#screen-game"),
    done:  $("#screen-done"),
    startBtn: $("#start"),
    next: $("#next"),
    skip: $("#skip"),
    prompt: $("#prompt"),
    choices: $("#choices"),
    score: $("#score"),
    streak: $("#streak"),
    bar: $("#bar"),
    clock: $("#clock"),
    target: $("#target"),
    resultTitle: $("#resultTitle"),
    resultSub: $("#resultSub"),
    again: $("#again"),
    csv: $("#csv"),
    json: $("#json"),
    summary: $("#summary"),
    player: $("#player"),
  };

  // Sounds (web audio)
  const snd = (()=>{
    let ctx; const safe = fn=>{ try{ fn(); }catch(e){} };
    function beep(type="sine", freq=880, dur=0.12, vol=0.06){
      ctx = ctx || new (window.AudioContext||window.webkitAudioContext||function(){})();
      if(typeof ctx === 'function') return;
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.type = type; o.frequency.value = freq; g.gain.value = vol;
      o.connect(g); g.connect(ctx.destination); o.start();
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + dur); o.stop(ctx.currentTime + dur);
    }
    return {
      correct(){ safe(()=>{beep("triangle",880,.11,.06); setTimeout(()=>beep("triangle",1320,.12,.05),90)}); },
      wrong(){ safe(()=>beep("sawtooth",180,.18,.06)); },
      tick(){ safe(()=>beep("sine",880,.05,.03)); },
      win(){ safe(()=>{beep("triangle",660,.1,.06); setTimeout(()=>beep("triangle",990,.1,.06),100); setTimeout(()=>beep("triangle",1320,.12,.06),200)}) },
      end(){ safe(()=>beep("square",660,.22,.06)); }
    };
  })();

  function m(txt){
    let s = String(txt).replace(/\^(\-?\d+)/g, (_,e)=>`<sup>${e}</sup>`);
    s = s.replace(/·/g,'&middot;');
    return s;
  }

  let i=0, order=[], score=0, streak=0, secs=TOTAL_SECS, tId=null, tLeft=TOTAL_SECS, history=[], current=null;

  function buildOrder(){
    order = shuffle(BANK.map((q,idx)=>({ idx, ...q })));
  }

  function start(){
    buildOrder(); i=0; score=0; streak=0; history=[];
    tLeft = TOTAL_SECS; S.target.textContent = TARGET;
    S.score.textContent = score; S.streak.textContent = streak;
    S.start.style.display="none"; S.done.style.display="none"; S.game.style.display="block";
    tickClock();
    tId = setInterval(()=>{
      tLeft -= .1;
      if (Math.ceil(tLeft) <= 5 && Math.abs(tLeft - Math.round(tLeft)) < 0.06) snd.tick();
      if (tLeft <= 0) { clearInterval(tId); finish(false); }
      tickClock();
    },100);
    nextQ();
  }

  function tickClock(){
    const m = Math.max(0, Math.floor(tLeft/60));
    const s = Math.max(0, Math.floor(tLeft%60));
    S.clock.textContent = `${m}:${s<10?'0'+s:s}`;
    const pct = Math.max(0, tLeft/TOTAL_SECS)*100;
    S.bar.style.width = pct + "%";
  }

  function nextQ(){
    if (i >= order.length) buildOrder(), i=0;
    current = order[i++];
    renderQ(current);
  }

  function renderQ(q){
    S.prompt.innerHTML = m(q.prompt);
    S.choices.innerHTML = "";
    S.next.disabled = true; S.skip.disabled = false;
    q.renderStart = performance.now();
    const opts = shuffle([q.correct, ...q.choices]).slice(0,4);
    opts.forEach(opt=>{
      const b = document.createElement("button");
      b.className = "choice";
      b.dataset.raw = opt;
      b.innerHTML = m(opt);
      b.addEventListener("click", ()=>pick(b, q, opt));
      S.choices.appendChild(b);
    });
  }

  function pick(btn, q, opt){
    const ok = (opt === q.correct);
    const t = Math.max(0, (performance.now() - q.renderStart)|0) / 1000;
    let gained = 0;
    if(ok){
      const timeBonus = Math.max(0, Math.round(300 * (1 - Math.min(1, t/10))));
      const base = 200;
      streak += 1;
      const streakBonus = Math.min(300, 50*(streak-1));
      gained = base + timeBonus + streakBonus;
      score += gained; snd.correct();
    }else{
      streak = 0; snd.wrong();
    }
    [...S.choices.children].forEach(el=>{
      const isC = el.dataset.raw === q.correct;
      if(isC) el.classList.add("correct");
      if(el===btn && !ok) el.classList.add("wrong");
      el.disabled = true;
    });
    S.score.textContent = score; S.streak.textContent = streak;
    S.next.disabled = false; S.skip.disabled = true;
    history.push({ prompt:q.prompt, correct:q.correct, pick:opt, ok, ms:Math.round(t*1000), gained });
    if(score >= TARGET){ clearInterval(tId); finish(true); }
  }

  function finish(won){
    S.game.style.display="none"; S.done.style.display="block";
    if(won){ S.resultTitle.textContent = "Target Reached!"; S.resultSub.textContent = `You hit ${TARGET} points!`; snd.win(); }
    else { S.resultTitle.textContent = "Time's Up"; S.resultSub.textContent = `Final score: ${score}`; snd.end(); }
    const right = history.filter(h=>h.ok).length;
    const total = history.length;
    const acc = total? Math.round(100*right/total):0;
    S.summary.textContent = `Answered: ${total} | Correct: ${right} (${acc}%) | Best streak: ${bestStreak()}`;
  }

  function bestStreak(){
    let best=0, cur=0;
    for(const h of history){
      if(h.ok){ cur+=1; best=Math.max(best,cur);} else {cur=0;}
    }
    return best;
  }

  S.startBtn.addEventListener("click", start);
  S.next.addEventListener("click", nextQ);
  S.skip.addEventListener("click", nextQ);
  S.again.addEventListener("click", ()=>location.reload());

  function download(data, name, type){
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([data],{type}));
    a.download = name; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
  }
  S.csv.addEventListener("click", ()=>{
    const rows = [["Player","Target","Seconds","Score","Answered","Correct","Accuracy%","Best Streak","Prompt","Your Answer","Correct Answer","OK","Gained","Time(ms)"]];
    const acc = history.length? Math.round(100*history.filter(h=>h.ok).length/history.length):0;
    const best = bestStreak();
    history.forEach(h=>{
      rows.push([S.player.value||"Player", TARGET, TOTAL_SECS, score, history.length, history.filter(x=>x.ok).length, acc, best, h.prompt, h.pick||"", h.correct, h.ok?"TRUE":"FALSE", h.gained, h.ms]);
    });
    const csv = rows.map(r=>r.map(v=>String(v).includes(',')?`"${String(v).replace(/"/g,'""')}"`:v).join(',')).join('\n');
    download(csv, `target_score_exponents_${Date.now()}.csv`, "text/csv");
  });
  S.json.addEventListener("click", ()=>{
    const payload = { player:S.player.value||"Player", target:TARGET, seconds:TOTAL_SECS, finalScore:score,
      answered:history.length, correct:history.filter(h=>h.ok).length, bestStreak:bestStreak(), results:history };
    download(JSON.stringify(payload,null,2), `target_score_exponents_${Date.now()}.json`, "application/json");
  });
})();
</script>
</body>
</html>
