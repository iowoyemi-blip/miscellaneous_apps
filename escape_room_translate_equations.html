<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Escape Room â€” Translate Word Problems â†’ Equations</title>
<style>
:root{ --bg:#0f172a; --card:#111827; --ink:#e5e7eb; --muted:#9ca3af; --accent:#0ea5e9; --good:#16a34a; --bad:#dc2626; --warn:#f59e0b; --ok:#22c55e; }
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(135deg,#0b1226,#0e1630 40%,#0d1b2a);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
.wrap{max-width:980px;margin:auto;padding:24px}
.card{background:rgba(17,24,39,.85);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:22px;box-shadow:0 10px 25px rgba(0,0,0,.35)}
h1{font-size:clamp(24px,3vw,34px);margin:0 0 8px}
.sub{color:var(--muted);margin:0 0 16px}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
input{background:#0b1020;color:var(--ink);border:1px solid rgba(255,255,255,.1);border-radius:10px;padding:10px 12px;font-size:16px;outline:none}
.btn{cursor:pointer;border:0;border-radius:12px;padding:10px 16px;font-weight:700;letter-spacing:.3px}
.btn.primary{background:var(--accent);color:white}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.2);color:var(--ink)}
.locks{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:14px}
.lock{background:#0b1020;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:6px;cursor:pointer;transition:transform .12s, box-shadow .12s}
.lock:hover{transform:translateY(-2px);box-shadow:0 10px 15px rgba(0,0,0,.25)}
.lock .name{font-weight:900}
.badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:#0b1020;border:1px solid rgba(255,255,255,.12);color:var(--muted);font-weight:800;font-size:12px}
.badge.ok{color:#86efac;border-color:rgba(34,197,94,.5)}
.grid{display:grid;grid-template-columns:repeat(2, minmax(260px,1fr));gap:12px;margin-top:10px}
.q{background:#0c1328;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px}
.q .prompt{font-weight:800;text-align:center;margin:4px 0 10px;font-size:18px}
.choice{display:block;width:100%;text-align:center;background:#0b1020;border:1px solid rgba(255,255,255,.08);color:var(--ink);border-radius:10px;padding:10px;font-weight:700;cursor:pointer;margin:6px 0;transition:.12s background,.12s transform}
.choice.correct{background:rgba(34,197,94,.18);border-color:rgba(34,197,94,.5)}
.choice.wrong{background:rgba(239,68,68,.18);border-color:rgba(239,68,68,.5)}
.panel{margin-top:16px;display:none}
.codebox{display:flex;align-items:center;gap:10px;margin-top:8px}
.digits{display:flex;gap:8px}
.digit{width:44px;height:44px;border-radius:10px;border:1px solid rgba(255,255,255,.12);display:flex;align-items:center;justify-content:center;font-weight:900;background:#0b1020}
.open{background:rgba(34,197,94,.16);border:1px solid rgba(34,197,94,.35)}
.math sup{font-size:.6em}
.note{font-size:13px;color:var(--muted)}
.small{font-size:12px;color:var(--muted)}
@media (max-width: 760px){
  .grid{grid-template-columns:1fr}
  .locks{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>
<div class="wrap">
  <div id="screen-start" class="card">
    <h1>Escape Room â€” Translate Word Problems â†’ Equations</h1>
    <p class="sub">Open all eight locks by answering correctly. <b>Code rule:</b> for each correct equation/inequality, <b>add the absolute values of all integers in it, then use the last digit</b> of that sum.
      <br><span class="small">Examples: <i>2x + 5 = 19 â†’ 2+5+19 = 26 â†’ digit 6</i>; <i>4 + 3m &lt;= 25 â†’ 4+3+25 = 32 â†’ digit 2</i>.</span></p>
    <div class="row">
      <label>Player name <input id="player" placeholder="e.g., Jordan A." autocomplete="off"></label>
      <label style="display:flex;align-items:center;gap:8px"><input id="shuffle" type="checkbox" checked> Shuffle answer choices</label>
    </div>
    <button class="btn primary" id="start">Enter the Room</button>
  </div>

  <div id="screen-game" class="card" style="display:none">
    <div class="row" style="justify-content:space-between">
      <div class="badge">Player: <span id="who">Player</span></div>
      <div class="badge">Locks opened: <span id="count">0</span>/8</div>
      <div class="badge">Attempts: <span id="tries">0</span></div>
    </div>
    <div class="locks" id="locks"></div>

    <div id="panel" class="panel">
      <h3 id="lname" style="margin:6px 0 6px">Room</h3>
      <div class="grid" id="grid"></div>
      <div class="codebox">
        <div class="digits" id="digits"></div>
        <button class="btn primary" id="tryOpen" disabled>Try Code</button>
        <span class="badge" id="msg"></span>
      </div>
      <p class="note">Digits update as you answer. Correct answers turn green; wrong turns red. When the code matches, the lock opens.</p>
      <p class="small">Tip: Use horizontal fraction bars and a centered dot (Â·) for products when you debrief solutions.</p>
    </div>
  </div>

  <div id="screen-done" class="card" style="display:none">
    <h1>Escaped! ðŸŽ‰</h1>
    <p class="sub">Great work, <b id="finName"></b> â€” you opened all the locks.</p>
    <div class="row">
      <div class="badge">Attempts: <span id="finTries"></span></div>
    </div>
    <div style="margin-top:12px;display:flex;gap:10px">
      <button class="btn primary" id="again">Play Again</button>
      <button class="btn ghost" id="csv">Export CSV</button>
      <button class="btn ghost" id="json">Export JSON</button>
    </div>
  </div>
</div>

<script>
const __DATA__ = {"BANK": [{"prompt": "Seven more than a number is 19.", "correct": "x + 7 = 19", "choices": ["7x = 19", "19 - 7 = x", "x - 7 = 19"]}, {"prompt": "Twice a number decreased by five equals 13.", "correct": "2x - 5 = 13", "choices": ["2(x - 5) = 13", "2x + 5 = 13", "x/2 - 5 = 13"]}, {"prompt": "Three less than four times a number is 29.", "correct": "4x - 3 = 29", "choices": ["3 - 4x = 29", "4(x - 3) = 29", "4x + 3 = 29"]}, {"prompt": "Half of a number plus 6 equals 20.", "correct": "x/2 + 6 = 20", "choices": ["2x + 6 = 20", "x/2 - 6 = 20", "x + 6/2 = 20"]}, {"prompt": "A rectangle has width w and length 3 more than twice the width. If the perimeter is 54, write an equation.", "correct": "2((2w + 3) + w) = 54", "choices": ["(2w + 3) + w = 54", "2(2w + 3) + w = 54", "2(2w) + 3 + w = 54"]}, {"prompt": "A square has side length (x + 5). If the perimeter is 68, write an equation.", "correct": "4(x + 5) = 68", "choices": ["x + 5 = 68", "2(x + 5) = 68", "x + 4(5) = 68"]}, {"prompt": "A rectangle has length 10 and width x. If the perimeter is 64, write an equation.", "correct": "2(10 + x) = 64", "choices": ["10 + x = 64", "2Â·10 + x = 64", "2x + 10 = 64"]}, {"prompt": "A rectangle has length 3x and width (x + 4). The perimeter is 70. Write an equation.", "correct": "2(3x + (x + 4)) = 70", "choices": ["3x + (x + 4) = 70", "2(3x) + (x + 4) = 70", "2(3x + x) + 4 = 70"]}, {"prompt": "A bicycle travels at 12 mph for x hours and covers 30 miles. Write an equation.", "correct": "12x = 30", "choices": ["x/12 = 30", "12 + x = 30", "12 - x = 30"]}, {"prompt": "A car travels at 60 mph for x hours and covers 150 miles. Write an equation.", "correct": "60x = 150", "choices": ["x/60 = 150", "60 + x = 150", "60x = 90"]}, {"prompt": "A jogger runs at 6 mph for x hours and covers 15 miles. Write an equation.", "correct": "6x = 15", "choices": ["x/6 = 15", "6 + x = 15", "6x = 9"]}, {"prompt": "A trip has two parts: 3 hours at 40 mph and x hours at 30 mph for a total of 210 miles. Write an equation.", "correct": "40Â·3 + 30x = 210", "choices": ["40 + 3 + 30x = 210", "30Â·3 + 40x = 210", "40x + 30Â·3 = 210"]}, {"prompt": "The sum of three consecutive integers is 72. Let the smallest be x. Write an equation.", "correct": "x + (x + 1) + (x + 2) = 72", "choices": ["x + x + x = 72", "x + (x + 2) = 72", "x + (x - 1) + (x - 2) = 72"]}, {"prompt": "The sum of two consecutive even integers is 54. Let the smaller be x. Write an equation.", "correct": "x + (x + 2) = 54", "choices": ["x + (x + 1) = 54", "2x + 2 = 54", "x + (x + 4) = 54"]}, {"prompt": "Let x be the smallest of three consecutive even integers. Their sum is 90. Write an equation.", "correct": "x + (x + 2) + (x + 4) = 90", "choices": ["x + (x + 1) + (x + 2) = 90", "3x + 2 = 90", "x + (x + 2) = 90"]}, {"prompt": "The sum of three consecutive odd integers is 75. Let the smallest be x. Write an equation.", "correct": "x + (x + 2) + (x + 4) = 75", "choices": ["x + (x + 1) + (x + 2) = 75", "3x + 3 = 75", "x + (x + 3) + (x + 6) = 75"]}, {"prompt": "Two complementary angles measure x and (x + 12). Write an equation.", "correct": "x + (x + 12) = 90", "choices": ["x + (x + 12) = 180", "x - (x + 12) = 90", "2x + 12 = 180"]}, {"prompt": "Two supplementary angles: the larger is 3x and the smaller is (x âˆ’ 10). Write an equation.", "correct": "3x + (x - 10) = 180", "choices": ["3x + (x - 10) = 90", "3x - (x - 10) = 180", "3x + x - 10 = 90"]}, {"prompt": "One angle is twice another; together they are complementary. Write an equation using x for the smaller angle.", "correct": "2x + x = 90", "choices": ["2x + x = 180", "2 + x = 90", "x + x = 90"]}, {"prompt": "Angles on a straight line: one is (4x âˆ’ 15) and the other is (x + 35). Write an equation.", "correct": "(4x - 15) + (x + 35) = 180", "choices": ["(4x - 15) + (x + 35) = 90", "4x - 15 + x + 35 = 90", "4x - 15 = x + 35"]}, {"prompt": "In a proportion, x is to 12 as 3 is to 8. Write an equation.", "correct": "8x = 36", "choices": ["x/12 = 3/8", "3x = 8Â·12", "12x = 24"]}, {"prompt": "A map scale is 1 cm : 5 km. A road measures 7 cm. Let d be the distance in km. Write an equation.", "correct": "d = 5Â·7", "choices": ["d/5 = 1/7", "7d = 5", "d = 7/5"]}, {"prompt": "A recipe uses a 2:5 ratio of sugar to flour. If sugar is x cups when flour is 20 cups, write an equation.", "correct": "x/20 = 2/5", "choices": ["x/5 = 2/20", "2x = 5Â·20", "x = 2Â·5Â·20"]}, {"prompt": "Two gears have teeth in the ratio 3:4. If the larger gear has 52 teeth, let x be the smaller. Write an equation.", "correct": "x/52 = 3/4", "choices": ["x/52 = 4/3", "4x = 3Â·52Â·52", "x + 52 = 3 + 4"]}, {"prompt": "A jar has nickels and dimes worth $1.25. There are 5 more dimes than nickels. Let n be nickels. Write an equation in cents.", "correct": "5n + 10(n + 5) = 125", "choices": ["5(n + 5) + 10n = 1250", "5n + 10n + 5 = 125", "10n + 5(n + 5) = 1250"]}, {"prompt": "You have x quarters and 4 more dimes than quarters. Total value is $3.20. Write an equation in cents.", "correct": "25x + 10(x + 4) = 320", "choices": ["25(x + 4) + 10x = 320", "25x + 10x + 4 = 320", "25x + 4Â·10 = 320x"]}, {"prompt": "A taxi charges a $3 base fee plus $2 per mile. The total cost is $19 for x miles. Write an equation.", "correct": "3 + 2x = 19", "choices": ["2 + 3x = 19", "3x + 2 = 19", "3 + x = 2Â·19"]}, {"prompt": "A taxi charges a $4 start fee and $3 per mile. Your budget is $25. Let m be miles you can ride. Write an inequality.", "correct": "4 + 3m <= 25", "choices": ["4 + 3m = 25", "3 + 4m <= 25", "4m + 3 <= 25"]}, {"prompt": "At a park, child tickets are $12 and adult tickets are $18. If 7 adult tickets were sold and the total is $138, how many child tickets x? Write an equation.", "correct": "18Â·7 + 12x = 138", "choices": ["12Â·7 + 18x = 138", "18x + 12 = 138", "12x = 138 + 18Â·7"]}, {"prompt": "A school trip buys 30 student tickets at $9 each and x teacher tickets at $12 each. Total is $354. Write an equation.", "correct": "9Â·30 + 12x = 354", "choices": ["9x + 12Â·30 = 354", "9Â·(30 + x) = 354", "12Â·(30 + x) = 354"]}, {"prompt": "For a show, child tickets are $8 and adult tickets are $11. A school sold 48 tickets total and collected $482. Let x be adult tickets. Write one equation.", "correct": "11x + 8(48 - x) = 482", "choices": ["11(48 - x) + 8x = 482", "11x + 8x = 482", "11(48) + 8x = 482"]}, {"prompt": "A group buys 25 wristbands at $15 each and x ride tickets at $3 each for a total of $450. Write an equation.", "correct": "15Â·25 + 3x = 450", "choices": ["15 + 25 + 3x = 450", "25Â·(15 + 3x) = 450", "15Â·25x + 3 = 450"]}], "LOCKS": [{"name": "Room A", "indices": [0, 1, 2, 3]}, {"name": "Room B", "indices": [4, 5, 6, 7]}, {"name": "Room C", "indices": [8, 9, 10, 11]}, {"name": "Room D", "indices": [12, 13, 14, 15]}, {"name": "Room E", "indices": [16, 17, 18, 19]}, {"name": "Room F", "indices": [20, 21, 22, 23]}, {"name": "Room G", "indices": [24, 25, 26, 27]}, {"name": "Room H", "indices": [28, 29, 30, 31]}], "TITLE": "Escape Room â€” Translate Word Problems â†’ Equations"};

(function(){
  const DATA = __DATA__;
  const $ = s=>document.querySelector(s);
  const el = id=>document.getElementById(id);
  const shuffle = arr => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);

  // simple web audio beeps
  const snd = (()=>{
    let ctx;
    function ok(freq){ try{
      ctx = ctx || new (window.AudioContext||window.webkitAudioContext)();
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.type="triangle"; o.frequency.value=freq; g.gain.value=.06;
      o.connect(g); g.connect(ctx.destination); o.start();
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + .12);
      o.stop(ctx.currentTime+.12);
    }catch(e){}}
    return {
      correct(){ ok(880); setTimeout(()=>ok(1320),90); },
      wrong(){ ok(180); },
      open(){ ok(660); setTimeout(()=>ok(990),110); setTimeout(()=>ok(1320),220); },
      end(){ ok(520); }
    };
  })();

  function m(txt){
    let s = String(txt);
    s = s.replace(/\^(\-?\d+)/g, (_,e)=>`<sup>${e}</sup>`);
    s = s.replace(/Â·/g,'&middot;').replace(/âˆ’/g,'-');
    return s;
  }

  // code digit rule: last digit of sum of |integers| in the correct equation/inequality
  function digitFromAnswer(ans){
    const s = String(ans).replace(/\s+/g,'');
    const nums = s.match(/-?\d+/g) || [];
    const sum = nums.reduce((a,b)=>a+Math.abs(parseInt(b,10)),0);
    return String(sum).slice(-1);
  }

  const S = {
    start: el('screen-start'),
    game: el('screen-game'),
    done: el('screen-done'),
    player: el('player'),
    shuffle: el('shuffle'),
    who: el('who'),
    count: el('count'),
    tries: el('tries'),
    locks: el('locks'),
    panel: el('panel'),
    lname: el('lname'),
    grid: el('grid'),
    digits: el('digits'),
    tryOpen: el('tryOpen'),
    msg: el('msg'),
    finName: el('finName'),
    finTries: el('finTries'),
  };

  let tries = 0;
  let opened = Array(DATA.LOCKS.length).fill(false);
  let currentLock = 0;
  let answers = {};
  const targets = DATA.LOCKS.map(L => L.indices.map(id => digitFromAnswer(DATA.BANK[id].correct)).join(''));

  el('start').addEventListener('click', ()=>{
    S.start.style.display='none'; S.game.style.display='block';
    S.who.textContent = S.player.value || 'Player';
    renderLocks();
    openLock(0);
  });

  el('again').addEventListener('click', ()=>location.reload());

  function renderLocks(){
    S.locks.innerHTML = '';
    DATA.LOCKS.forEach((L, idx)=>{
      const card = document.createElement('div');
      card.className = 'lock' + (opened[idx]?' open':'');
      card.innerHTML = `<div class="name">${L.name}</div>
                        <div class="badge ${opened[idx]?'ok':''}">${opened[idx]?'Opened':'Locked'}</div>
                        <div class="note">Answer all ${L.indices.length} questions</div>`;
      card.addEventListener('click', ()=> openLock(idx));
      S.locks.appendChild(card);
    });
    S.count.textContent = opened.filter(Boolean).length;
  }

  function buildDigitsView(code, need){
    S.digits.innerHTML = '';
    const chars = code.split('');
    for(let i=0;i<need;i++){
      const d = document.createElement('div');
      d.className = 'digit';
      d.textContent = chars[i] || 'â€¢';
      S.digits.appendChild(d);
    }
  }

  function openLock(idx){
    currentLock = idx;
    const L = DATA.LOCKS[idx];
    S.panel.style.display = 'block';
    S.lname.textContent = `${L.name} â€” answer all ${L.indices.length}`;
    S.grid.innerHTML = '';
    S.msg.textContent = '';
    const show = L.indices.map(id => Object.assign({id}, DATA.BANK[id]));
    show.forEach((q)=>{
      const card = document.createElement('div'); card.className='q';
      const opts = (S.shuffle.checked ? shuffle([q.correct, ...q.choices]) : [q.correct, ...q.choices]).slice(0,4);
      card.innerHTML = `<div class="prompt math">${m(q.prompt)}</div><div class="choices"></div>`;
      const choicesDiv = card.querySelector('.choices');
      opts.forEach(opt=>{
        const b = document.createElement('button');
        b.className = 'choice'; b.dataset.raw = opt; b.innerHTML = m(opt);
        b.addEventListener('click', ()=> pick(b, q, opt));
        choicesDiv.appendChild(b);
      });
      S.grid.appendChild(card);
    });
    updateDigits();
    S.tryOpen.disabled = true;
  }

  function pick(btn, q, opt){
    const correct = (opt === q.correct);
    btn.classList.remove('wrong','correct');
    if(correct){ btn.classList.add('correct'); snd.correct(); }
    else { btn.classList.add('wrong'); snd.wrong(); }
    if(correct){
      [...btn.parentElement.children].forEach(el=>{ el.disabled = true; if(el!==btn) el.classList.add('wrong'); });
      answers[currentLock] = answers[currentLock] || {};
      answers[currentLock][q.id] = opt;
      updateDigits();
      checkReady();
    }else{
      tries += 1; S.tries.textContent = String(tries);
    }
  }

  function updateDigits(){
    const L = DATA.LOCKS[currentLock];
    const need = L.indices.length;
    const code = L.indices.map(id => {
      const chosen = answers[currentLock] && answers[currentLock][id];
      return chosen ? digitFromAnswer(chosen) : '';
    }).join('');
    buildDigitsView(code, need);
  }

  function checkReady(){
    const L = DATA.LOCKS[currentLock];
    const haveAll = L.indices.every(id => answers[currentLock] && answers[currentLock][id]);
    S.tryOpen.disabled = !haveAll;
  }

  S.tryOpen.addEventListener('click', ()=>{
    const L = DATA.LOCKS[currentLock];
    const code = L.indices.map(id => digitFromAnswer(answers[currentLock][id])).join('');
    const target = targets[currentLock];
    if(code === target){
      opened[currentLock] = true;
      renderLocks();
      S.msg.textContent = "Unlocked!";
      S.msg.classList.add('ok');
      snd.open();
      const next = opened.indexOf(false);
      if(next === -1){
        S.game.style.display = 'none'; S.done.style.display = 'block'; snd.end();
        document.getElementById('finName').textContent = S.player.value || 'Player';
        document.getElementById('finTries').textContent = String(tries);
      }else{
        openLock(next);
      }
    }else{
      tries += 1; S.tries.textContent = String(tries);
      S.msg.textContent = "Wrong code â€” keep checking.";
      S.msg.classList.remove('ok');
      snd.wrong();
    }
  });

  function download(data, name, type){
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([data],{type}));
    a.download = name; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
  }
  function exportCSV(){
    const rows = [["Player","Attempts","Locks Opened","Lock","Code Entered","Correct Code"]];
    DATA.LOCKS.forEach((L, idx)=>{
      const code = (answers[idx]? L.indices.map(id => digitFromAnswer(answers[idx][id]||"")).join('') : "");
      rows.push([document.getElementById('player').value||"Player", tries, opened.filter(Boolean).length, L.name, code, targets[idx]]);
    });
    const csv = rows.map(r=>r.map(v=>String(v).includes(',')?`"${String(v).replace(/"/g,'""')}"`:v).join(',')).join('\\n');
    download(csv, `escape_translate_equations_results_${Date.now()}.csv`, "text/csv");
  }
  function exportJSON(){
    const payload = {
      player: document.getElementById('player').value || "Player",
      attempts: tries,
      opened: opened,
      locks: DATA.LOCKS.map((L,idx)=>({ name:L.name, entered: (answers[idx]? L.indices.map(id => digitFromAnswer(answers[idx][id]||"")).join('') : null), target: targets[idx] }))
    };
    download(JSON.stringify(payload,null,2), `escape_translate_equations_results_${Date.now()}.json`, "application/json");
  }
  document.getElementById('csv').addEventListener('click', exportCSV);
  document.getElementById('json').addEventListener('click', exportJSON);
})();

</script>
</body>
</html>
